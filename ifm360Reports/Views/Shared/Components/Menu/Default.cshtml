@model List<ifm360Reports.Models.MenuViewModel>
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    var path = HttpContextAccessor.HttpContext.Request.Path.Value?.ToLower() ?? "";
    var query = HttpContextAccessor.HttpContext.Request.QueryString.Value?.ToLower() ?? "";
    var currentUrl = path + query;
    var collapseIndex = 0;
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />





<ul class="list-unstyled components">
    <li class="active">
        @if (HttpContextAccessor.HttpContext.Session.GetString("UserName").ToString() != "HRAdmin")
        {
            <a href="~/Home/BranchLogin" class="branchbtn"><span>Branch Selection</span></a>
        }
        @foreach (var menu in Model ?? new List<ifm360Reports.Models.MenuViewModel>())
        {
            var collapseId = $"collapseMenu{collapseIndex++}";
            var hasSub = menu.SubMenus != null && menu.SubMenus.Any();
            var isActiveParent = hasSub && menu.SubMenus.Any(s =>
            !string.IsNullOrEmpty(s.MenuUrl) &&
            currentUrl.Contains(s.MenuUrl.ToLower()));
            

            if (hasSub)
            {
                <a data-toggle="collapse" aria-expanded="false"  class="dropdown-toggle collapsed" href="#@collapseId">
                    <span>@menu.MenuName</span>
                </a>
                <ul class="list-unstyled collapse" id="@collapseId">
                    @foreach (var smenu in menu.SubMenus)
                    {
                        <li>
                            <a href="~/@smenu.MenuUrl"><span>@smenu.SubMenuName</span></a>
                        </li>
                    }
                </ul>
            }
            else
            {
                <a href="~/@menu.MenuUrl"><span>@menu.MenuName</span></a>
            }
        }
    </li>
</ul>



